@using Microsoft.AspNetCore.Components.Authorization
@using System.Security.Claims

@namespace Olympus.Core.Frontend.Authorization

@if (_canShow)
{
	@Authorized
}
else
{
	@NotAuthorized
}

@code {

	[CascadingParameter]
	private Task<AuthenticationState>? AuthStateTask { get; set; }

	[Parameter]
	public int? One { get; set; }

	[Parameter]
	public int[]? Any { get; set; }

	[Parameter]
	public int[]? All { get; set; }

	[Parameter]
	public RenderFragment? Authorized { get; set; }

	[Parameter]
	public RenderFragment? NotAuthorized { get; set; }

	private bool _canShow;

	protected override async Task OnParametersSetAsync()
	{
		// 1. Reseta o estado
		_canShow = false;

		if (AuthStateTask is null) return;

		// 2. Faz o await de forma ass√≠ncrona, sem bloquear a UI
		var authState = await AuthStateTask;
		var user = authState.User;

		if (user.Identity?.IsAuthenticated != true) return;

		if (!user.CheckPermissions(One, Any, All)) return;

		_canShow = true;

	}

}